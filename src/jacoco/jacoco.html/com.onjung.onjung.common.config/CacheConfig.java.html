<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CacheConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">onjung</a> &gt; <a href="index.source.html" class="el_package">com.onjung.onjung.common.config</a> &gt; <span class="el_source">CacheConfig.java</span></div><h1>CacheConfig.java</h1><pre class="source lang-java linenums">package com.onjung.onjung.common.config;

import net.sf.ehcache.Cache;
import net.sf.ehcache.config.CacheConfiguration;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.cache.CacheManager;
import org.springframework.cache.annotation.CachingConfigurerSupport;
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.cache.ehcache.EhCacheCacheManager;
import org.springframework.cache.ehcache.EhCacheManagerFactoryBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

import java.util.Objects;

@EnableCaching
@Configuration
<span class="fc" id="L20">public class CacheConfig extends CachingConfigurerSupport {</span>

    //CacacheManager의 적절한 관리 및 인스턴스를 제공하는데 필요하며 EhCache 설정 리소스를 구성한다.
    @Bean
    public EhCacheManagerFactoryBean cacheManagerFactoryBean(){
<span class="fc" id="L25">        EhCacheManagerFactoryBean factoryBean = new EhCacheManagerFactoryBean();</span>
        //테스트를 위해 추가
<span class="fc" id="L27">        factoryBean.setShared(true);</span>
<span class="fc" id="L28">        return factoryBean;</span>
    }

    //  EhcacheManager 등록
    @Bean
    @Primary
    public EhCacheCacheManager ehCacheCacheManager(){

        // 클라이언트 피드 캐시 설정
<span class="fc" id="L37">        CacheConfiguration clientFeedConfiguration = new CacheConfiguration()</span>
<span class="fc" id="L38">                .eternal(false) //true일 경우 timeout 관련 설정이 무시, element가 캐시에서 삭제되지 않음.</span>
<span class="fc" id="L39">                .timeToIdleSeconds(0) //Element가 지정한 시간 동안 사용(조회)되지 않으면 캐시에서 제거된다. 이 값이 0인 경우 조회 관련 만료 시간을 지정하지 않는다.</span>
<span class="fc" id="L40">                .timeToLiveSeconds(21600) //Element가 존재하는 시간. 이 시간이 지나면 캐시에서 제거된다. 이 시간이 0이면 만료 시간을 지정하지 않는다.</span>
<span class="fc" id="L41">                .maxEntriesLocalHeap(0) //Heap 캐시 메모리 pool size 설정, GC대상이 됨.</span>
<span class="fc" id="L42">                .memoryStoreEvictionPolicy(&quot;LRU&quot;) //캐시가 가득찼을때 관리 알고리즘 설정 default &quot;LRU&quot;</span>
<span class="fc" id="L43">                .name(&quot;clientFeedCaching&quot;);</span>

        // 서버 피드 캐시 설정
<span class="fc" id="L46">        CacheConfiguration severFeedConfiguration = new CacheConfiguration()</span>
<span class="fc" id="L47">                .eternal(false) //true일 경우 timeout 관련 설정이 무시, element가 캐시에서 삭제되지 않음.</span>
<span class="fc" id="L48">                .timeToIdleSeconds(0) //Element가 지정한 시간 동안 사용(조회)되지 않으면 캐시에서 제거된다. 이 값이 0인 경우 조회 관련 만료 시간을 지정하지 않는다.</span>
<span class="fc" id="L49">                .timeToLiveSeconds(21600) //Element가 존재하는 시간. 이 시간이 지나면 캐시에서 제거된다. 이 시간이 0이면 만료 시간을 지정하지 않는다.</span>
<span class="fc" id="L50">                .maxEntriesLocalHeap(0) //Heap 캐시 메모리 pool size 설정, GC대상이 됨.</span>
<span class="fc" id="L51">                .memoryStoreEvictionPolicy(&quot;LRU&quot;) //캐시가 가득찼을때 관리 알고리즘 설정 default &quot;LRU&quot;</span>
<span class="fc" id="L52">                .name(&quot;serverFeedCaching&quot;);</span>

        // 설정을 가지고 캐시 생성
<span class="fc" id="L55">        Cache clientFeedCaching = new net.sf.ehcache.Cache(clientFeedConfiguration);</span>
<span class="fc" id="L56">        Cache severFeedCaching = new net.sf.ehcache.Cache(severFeedConfiguration);</span>

        // 캐시 팩토리에 생성한 eh캐시를 추가
<span class="fc" id="L59">        Objects.requireNonNull(cacheManagerFactoryBean().getObject()).addCache(clientFeedCaching);</span>
<span class="fc" id="L60">        Objects.requireNonNull(cacheManagerFactoryBean().getObject()).addCache(severFeedCaching);</span>

        // 캐시 팩토리를 넘겨서 eh캐시 매니저 생성
<span class="fc" id="L63">        return new EhCacheCacheManager(Objects.requireNonNull(cacheManagerFactoryBean().getObject()));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>